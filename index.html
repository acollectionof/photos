<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photos</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="header">
    <h1>Photos test</h1>
  </header>

  <main class="wrap">
    <div id="grid" class="grid"></div>
  </main>

  <script>
  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function weightedPick(options) {
    const total = options.reduce((s, o) => s + o.w, 0);
    let r = Math.random() * total;
    for (const o of options) {
      r -= o.w;
      if (r <= 0) return o.name;
    }
    return options[options.length - 1].name;
  }

  const sizeWeights = [
    { name: "span-1", w: 80 },
    { name: "span-2", w: 18 },
    { name: "span-3", w: 2 }
  ];

  const lightbox = document.getElementById("lightbox");
  const lbImage = document.querySelector(".lb-image");
  const lbClose = document.querySelector(".lb-close");

  let currentIndex = 0;
  let images = [];

  function openLightbox(index){
    currentIndex = index;
    lbImage.src = images[currentIndex];
    lightbox.classList.add("open");
    lightbox.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closeLightbox(){
    lightbox.classList.remove("open");
    lightbox.setAttribute("aria-hidden", "true");
    lbImage.src = "";
    document.body.style.overflow = "";
  }

  function showNext(dir){
    currentIndex = (currentIndex + dir + images.length) % images.length;
    lbImage.src = images[currentIndex];
  }

  lbClose.addEventListener("click", closeLightbox);
  lightbox.addEventListener("click", e => {
    if (e.target === lightbox) closeLightbox();
  });

  document.addEventListener("keydown", e => {
    if (!lightbox.classList.contains("open")) return;
    if (e.key === "Escape") closeLightbox();
    if (e.key === "ArrowRight") showNext(1);
    if (e.key === "ArrowLeft") showNext(-1);
  });

  fetch(new URL("photos.json", window.location.href))
    .then(r => r.json())
    .then(files => {
      images = shuffle(files);
      const grid = document.getElementById("grid");
      const frag = document.createDocumentFragment();

      images.forEach((src, i) => {
        const a = document.createElement("a");
        a.href = src;
        a.className = "tile " + weightedPick(sizeWeights);
        a.addEventListener("click", e => {
          e.preventDefault();
          openLightbox(i);
        });

        const img = document.createElement("img");
        img.src = src;
        img.loading = "lazy";
        img.decoding = "async";
        img.alt = "";

        a.appendChild(img);
        frag.appendChild(a);
      });

      grid.appendChild(frag);
    })
    .catch(err => {
      document.getElementById("grid").innerHTML =
        "<p>Couldnâ€™t load photos.json.</p>";
      console.error(err);
    });
</script>

  <!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button class="lb-close" aria-label="Close">&times;</button>
  <img class="lb-image" alt="">
</div>


</body>
</html>
